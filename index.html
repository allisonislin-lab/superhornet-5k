<!-- index.html (GitHub Pages) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Superhornet 5K Trail Race — Registration</title>

<style>
  *, *::before, *::after { box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#0b1220; color:#eaf0ff; }
  header { padding: 28px 18px; background: linear-gradient(135deg,#152a55,#0b1220); }
  .wrap { max-width: 900px; margin: 0 auto; }
  h1 { margin:0 0 6px; font-size: 28px; }
  .sub { opacity:.9; }
  main { padding: 18px; }
  .card { background:#111b33; border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:18px; margin:12px 0; overflow:hidden; }
  label { display:block; font-size:13px; margin:10px 0 6px; opacity:.95; }
  input, select { width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background:#0b1220; color:#eaf0ff; font-size:16px; }
  .grid { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
  @media (max-width:720px){ .grid { grid-template-columns:1fr; } }
  button { padding:12px; border-radius:12px; border:none; background:#ff3b30; color:#fff; font-weight:700; cursor:pointer; width:100%; }
  button:disabled { opacity:.6; cursor:not-allowed; }
  .small { font-size:12px; opacity:.85; }
  .ok { color:#78ff9e; }
  .err { color:#ff8a8a; }
  .row { display:flex; gap:10px; align-items:center; }
  .row input[type="checkbox"] { width:auto; }
  footer { padding:22px 18px; opacity:.75; }
</style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>Superhornet 5K Trail Race</h1>
    <div class="sub">Participant registration — Entry fee: $25 (Venmo)</div>
    <div class="small">Site version: 2026-02-04</div>
  </div>
</header>

<main class="wrap">

  <div class="card">
    <strong>Registration Fee: $25</strong>
    <p class="small" style="margin:8px 0 0;">
      Send <strong>$25 via Venmo</strong> to <strong>@Allison-Islin</strong><br>
      <em>Include the runner’s full name in the payment note.</em>
    </p>
  </div>

  <div class="card">
    <strong>Connection Check</strong>
    <div class="small" id="debugEndpoint"></div>
    <button id="pingBtn" type="button" style="margin-top:10px;">Ping Server</button>
    <div class="small" id="pingResult" style="margin-top:8px;"></div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 8px;">Register</h2>
    <div class="small">Fields marked * are required.</div>

    <form id="regForm" onsubmit="return false;">
      <div class="grid">
        <div><label>First name *</label><input name="firstName" required></div>
        <div><label>Last name *</label><input name="lastName" required></div>
        <div><label>Email *</label><input name="email" type="email" required></div>
        <div><label>Phone</label><input name="phone"></div>
        <div><label>Date of birth</label><input name="dob" type="date"></div>
        <div>
          <label>Gender</label>
          <select name="gender">
            <option value="">—</option>
            <option>Female</option>
            <option>Male</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
          </select>
        </div>
      </div>

      <div class="grid">
        <div><label>Address</label><input name="address"></div>
        <div><label>City</label><input name="city"></div>
        <div><label>State</label><input name="state"></div>
        <div><label>Zip</label><input name="zip"></div>
      </div>

      <div class="grid">
        <div><label>Emergency contact name *</label><input name="emergencyName" required></div>
        <div><label>Emergency contact phone *</label><input name="emergencyPhone" required></div>
        <div>
          <label>Shirt size</label>
          <select name="shirtSize">
            <option value="">—</option>
            <option>YS</option><option>YM</option><option>YL</option>
            <option>S</option><option>M</option><option>L</option>
            <option>XL</option><option>XXL</option>
          </select>
        </div>
        <div><label>Venmo username *</label><input name="venmoUsername" required placeholder="@username"></div>
      </div>

      <label>Venmo payment note *</label>
      <input name="venmoNote" required placeholder="Runner full name">

      <div class="card" style="background:#0b1220">
        <strong>Waiver *</strong>
        <p class="small">
          I understand trail running involves risk. I assume all risks of participation and release
          the organizers, volunteers, sponsors, and venue from liability except where prohibited by law.
        </p>
        <div class="row">
          <input id="waiver" type="checkbox" required>
          <label for="waiver" style="margin:0;">I accept the waiver *</label>
        </div>
      </div>

      <button id="submitBtn" type="button">Submit Registration</button>
      <div id="msg" style="margin-top:10px;"></div>
    </form>
  </div>

</main>

<footer class="wrap">
  <div class="small">© Superhornet 5K Trail Race</div>
</footer>

<script>
  const ENDPOINT = https://script.google.com/macros/s/AKfycbxyrsIxlX7hGw1-gZcob_uAP-nkV3uOCU-FNg5hCO27K4I6NOFiTW2CmZ8cD54J35pw/exec; // must end with /exec

  const form = document.getElementById("regForm");
  const btn  = document.getElementById("submitBtn");
  const msg  = document.getElementById("msg");

  document.getElementById("debugEndpoint").textContent = "ENDPOINT: " + ENDPOINT;

  function show(type, html) {
    msg.innerHTML = `<div class="${type}" style="padding:10px 0;">${html}</div>`;
    msg.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  document.getElementById("pingBtn").addEventListener("click", async () => {
    const out = document.getElementById("pingResult");
    out.textContent = "Pinging…";
    try {
      const res = await fetch(ENDPOINT, { method: "GET" });
      const text = await res.text();
      out.textContent = "Server says: " + text;
    } catch (e) {
      out.textContent = "Ping failed: " + String(e);
    }
  });

  async function submitForm() {
    btn.disabled = true;
    show("small", "Submitting…");

    const data = Object.fromEntries(new FormData(form).entries());
    data.waiverAccepted = document.getElementById("waiver").checked;

    try {
      const res = await fetch(ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const text = await res.text();
      let out;
      try { out = JSON.parse(text); }
      catch { out = { ok:false, error:text || "Non-JSON response" }; }

      if (out.ok) {
        show("ok", "✅ Registration submitted successfully.<br>Payment pending verification via Venmo.");
        form.reset();
      } else {
        show("err", "❌ Submission failed:<br>" + (out.error || "Unknown error"));
      }
    } catch (err) {
      show("err", "❌ Network error:<br>" + String(err));
    } finally {
      btn.disabled = false;
    }
  }

  btn.addEventListener("click", submitForm);
</script>
</body>
</html>
